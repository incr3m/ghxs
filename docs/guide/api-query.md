<Meta title="API/apiQuery" />

# ApiQuery API

`apiQuery` aims to simplify use of embrace backend API without having to deal with Graphql. This function abstracts away gql by generating queries.

This also provides typesafe variable parameter and return type based on specified `query key`.

> Note: apiQuery on utilizes queries and mutations available from schema. These are mostly CRUD operations generated by Appsync. If your looking for custom API operations for specific records, navigate to `src/common/graphql-api/mutations` or `src/common/graphql-api/queries`

---

Sample usage:

```tsx
import { apiQuery } from 'common/graphql-api';

...

const result = await apiQuery({
  key: 'getIssue',
  variables: { id: 'issue-id' },
});
```

## Options

**depthLimit** : `number(optional | default: 1)` - this configures how deep nested connections on each records will be returned. Current default value is 1 which force to only return root level field of the record

```tsx
const result = await apiQuery({
  key: 'searchActivitys',
  variables: {
    filter: {
      status: { eq: 'completed' },
    },
  },
  depthLimit: 2,
});

// sample response
{
  items: [
    {
      id: 'activity-1',
      status: 'pending',
      // user connection will be included
      user: {
        id: 'user-1',
        name: 'dog',
      },
    },
  ];
}
```

---

## Query detection

Only GraphQL Appsync queries are available. If new queries are not appearing on the list, try running `yarn codegen` command.

Auto detect available queries:

![image](https://user-images.githubusercontent.com/3125784/204133158-e071e416-1030-4a38-b4d1-df0e53e6a2ad.png)

Typed response object:

![image](https://user-images.githubusercontent.com/3125784/204132683-adf13951-bf5c-4cd8-9cc9-67909aaae7b5.png)

Typed variables:

![image](https://user-images.githubusercontent.com/3125784/204132810-c43613ac-b47c-4c40-bc0c-5261584af6ef.png)
